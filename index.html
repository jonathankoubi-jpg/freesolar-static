<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Freesolar ‚Äî √âtude solaire</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    :root { --blue:#0A2342; --yellow:#FFD100; --bg:#F7F9FC; --text:#111827; }
    *{box-sizing:border-box} body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text)}
    header{background:var(--blue);color:#fff;padding:20px} .wrap{max-width:980px;margin:0 auto;padding:0 16px}
    .brand{display:flex;align-items:center;gap:12px} .logo{width:40px;height:40px;border-radius:8px;background:linear-gradient(135deg,var(--yellow),#fff380);display:flex;align-items:center;justify-content:center;color:var(--blue);font-weight:900}
    .hero{background:#fff;margin:24px auto;padding:24px;border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,.06)}
    h1{font-size:28px;margin:0 0 6px} p.lead{margin:0;opacity:.8}
    .grid{display:grid;grid-template-columns:1fr;gap:16px;margin-top:16px}@media(min-width:860px){.grid{grid-template-columns:1fr 1fr}}
    .card{background:#fff;padding:20px;border-radius:14px;box-shadow:0 8px 24px rgba(0,0,0,.06)}
    label{display:block;font-size:14px;margin-bottom:6px} input,select,button{width:100%;padding:12px;border:1px solid #E5E7EB;border-radius:10px;font-size:16px}
    input[type="checkbox"]{width:auto;transform:scale(1.1);accent-color:var(--yellow)} .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    button{background:var(--yellow);color:var(--blue);font-weight:800;border:none;cursor:pointer} button:hover{filter:brightness(.95)}
    .tel{font-weight:700;color:var(--yellow)} .ok{display:none;color:#059669;font-weight:700;margin-top:10px}
    footer{text-align:center;font-size:12px;color:#6B7280;padding:32px 0}
  </style>
</head>
<body>
  <header>
    <div class="wrap brand">
      <div class="logo">FS</div>
      <div>
        <div style="font-weight:900;letter-spacing:.3px;">Freesolar</div>
        <div style="opacity:.8;font-size:13px">R√©duction √©nerg√©tique jusqu‚Äô√† 60%</div>
      </div>
      <div style="margin-left:auto;font-size:14px">üìû <span class="tel">09 72 00 00 00</span></div>
    </div>
  </header>

  <main class="wrap">
    <section class="hero">
      <h1>Obtenez votre √©tude solaire en 2 minutes</h1>
      <p class="lead">Un conseiller vous rappelle apr√®s v√©rification de votre √©ligibilit√©.</p>
      <div class="grid">
        <!-- FORMULAIRE -->
        <form class="card" id="lead">
          <div class="row">
            <div><label>Pr√©nom</label><input name="prenom" required /></div>
            <div><label>Nom</label><input name="nom" required /></div>
          </div>
          <div class="row">
            <div><label>T√©l√©phone</label><input name="telephone" required placeholder="06..." /></div>
            <div><label>E‚Äëmail</label><input type="email" name="email" required placeholder="vous@exemple.fr" /></div>
          </div>
          <div>
            <label>√ätes‚Äëvous propri√©taire de votre maison ?</label>
            <select name="proprietaire" required>
              <option value="">‚Äî</option><option>Oui</option><option>Non</option>
            </select>
          </div>
          <div>
            <label>Orientation de toiture</label>
            <select name="toiture" required>
              <option value="">‚Äî</option>
              <option>Sud / Sud‚ÄëEst / Sud‚ÄëOuest</option>
              <option>Est / Ouest</option>
              <option>Nord</option>
              <option>Je ne sais pas</option>
            </select>
          </div>
          <label style="display:flex;gap:10px;align-items:center;margin:8px 0">
            <input id="int60" type="checkbox" name="interesse_60" />
            Je suis int√©ress√© par une r√©duction √©nerg√©tique <b>jusqu‚Äô√† 60%</b>
          </label>
          <button type="submit">Recevoir mon √©tude</button>
          <p class="ok" id="ok">‚úÖ Merci ! Nous vous rappelons tr√®s vite.</p>
        </form>

        <!-- EXPLICATIONS -->
        <div class="card">
          <h3 style="margin-top:0">Comment √ßa marche ?</h3>
          <ol>
            <li>Vous compl√©tez le formulaire.</li>
            <li>Un t√©l√©conseiller v√©rifie votre √©ligibilit√©.</li>
            <li>√âtude technique √† distance + devis.</li>
            <li>Signature √©lectronique.</li>
            <li>Installation par un partenaire RGE.</li>
          </ol>
          <p style="margin-top:12px;font-size:14px;opacity:.8">C‚Äôest gratuit et sans engagement.</p>
        </div>
      </div>
    </section>
  </main>

  <footer>¬© 2025 Freesolar ‚Äî Tous droits r√©serv√©s.</footer>

  <!-- SCRIPT SUPABASE + DEBUG -->
  <script>
    // ‚öôÔ∏è Remplace ces 2 constantes si besoin
    const SUPABASE_URL = "https://jwebaerikvvdaxyagkpx.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp3ZWJhZXJpa3Z2ZGF4eWFna3B4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUwMTEzNjMsImV4cCI6MjA3MDU4NzM2M30.mMC9F8sIovTE4r1HXKYXL8c9SexagzEqK6s_ErZ3fiI";
  </script>
  <script>
    const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const form = document.getElementById('lead');
    const ok = document.getElementById('ok');

    // Bloc debug lisible en bas de page
    const debug = document.createElement('pre');
    debug.style.background = '#f3f4f6';
    debug.style.padding = '8px';
    debug.style.fontSize = '12px';
    debug.style.whiteSpace = 'pre-wrap';
    debug.textContent = 'Debug pr√™t‚Ä¶';
    document.body.appendChild(debug);

    // Afficher 5 derniers leads
    async function loadLeads() {
      const { data, error, status } = await sb
        .from('leads')
        .select('prenom,nom,created_at')
        .order('created_at', { ascending: false })
        .limit(5);
      debug.textContent = `GET leads status=${status}\n` +
        (error ? `ERROR: ${error.message}` : JSON.stringify(data, null, 2));
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const fd = new FormData(form);
      const payload = {
        prenom: String(fd.get('prenom') || ''),
        nom: String(fd.get('nom') || ''),
        telephone: String(fd.get('telephone') || ''),
        email: String(fd.get('email') || ''),
        proprietaire: String(fd.get('proprietaire') || ''),
        toiture: String(fd.get('toiture') || ''),
        interesse_60: !!fd.get('interesse_60'),
      };

      const { data, error, status } = await sb
        .from('leads')
        .insert([payload])
        .select(); // renvoie la ligne ins√©r√©e

      if (error) {
        alert("Erreur Supabase : " + error.message);
        debug.textContent = `POST leads status=${status}\nERROR: ${error.message}`;
        return;
      }

      ok.style.display = 'block';
      form.reset();
      debug.textContent = `POST leads status=${status}\n` + JSON.stringify(data, null, 2);
      loadLeads();
    });

    // Chargement initial
    loadLeads();
  </script>
</body>
</html>
