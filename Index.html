<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Freesolar — Étude solaire</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    :root { --blue:#0A2342; --yellow:#FFD100; --bg:#F7F9FC; --text:#111827; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text)}
    header{background:var(--blue);color:#fff;padding:20px}
    .wrap{max-width:980px;margin:0 auto;padding:0 16px}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:40px;height:40px;border-radius:8px;background:linear-gradient(135deg,var(--yellow),#fff380);display:flex;align-items:center;justify-content:center;color:var(--blue);font-weight:900}
    .hero{background:#fff;margin:24px auto;padding:24px;border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,.06)}
    h1{font-size:28px;margin:0 0 6px} p.lead{margin:0;opacity:.8}
    .grid{display:grid;grid-template-columns:1fr;gap:16px;margin-top:16px}
    @media(min-width:860px){.grid{grid-template-columns:1fr 1fr}}
    .card{background:#fff;padding:20px;border-radius:14px;box-shadow:0 8px 24px rgba(0,0,0,.06)}
    label{display:block;font-size:14px;margin-bottom:6px}
    input,select,button{width:100%;padding:12px;border:1px solid #E5E7EB;border-radius:10px;font-size:16px}
    input[type="checkbox"]{width:auto;transform:scale(1.1);accent-color:var(--yellow)}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    button{background:var(--yellow);color:var(--blue);font-weight:800;border:none;cursor:pointer}
    button:hover{filter:brightness(.95)}
    .tel{font-weight:700;color:var(--yellow)}
    .ok{display:none;color:#059669;font-weight:700;margin-top:10px}
    footer{text-align:center;font-size:12px;color:#6B7280;padding:32px 0}
    pre.debug{background:#f3f4f6;padding:8px;border-radius:8px;font-size:12px;white-space:pre-wrap}
  </style>
</head>
<body>
  <header>
    <div class="wrap brand">
      <div class="logo">FS</div>
      <div>
        <div style="font-weight:900;letter-spacing:.3px;">Freesolar</div>
        <div style="opacity:.8;font-size:13px">Réduction énergétique jusqu’à 60%</div>
      </div>
      <div style="margin-left:auto;font-size:14px">📞 <span class="tel">09 72 00 00 00</span></div>
    </div>
  </header>

  <main class="wrap">
    <section class="hero">
      <h1>Obtenez votre étude solaire en 2 minutes</h1>
      <p class="lead">Un conseiller vous rappelle après vérification de votre éligibilité.</p>
      <div class="grid">
        <!-- FORMULAIRE -->
        <form class="card" id="lead">
          <div class="row">
            <div><label>Prénom</label><input name="prenom" required /></div>
            <div><label>Nom</label><input name="nom" required /></div>
          </div>
          <div class="row">
            <div><label>Téléphone</label><input name="telephone" required placeholder="06..." /></div>
            <div><label>E‑mail</label><input type="email" name="email" required placeholder="vous@exemple.fr" /></div>
          </div>
          <div>
            <label>Êtes‑vous propriétaire de votre maison ?</label>
            <select name="proprietaire" required>
              <option value="">—</option><option>Oui</option><option>Non</option>
            </select>
          </div>
          <div>
            <label>Orientation de toiture</label>
            <select name="toiture" required>
              <option value="">—</option>
              <option>Sud / Sud‑Est / Sud‑Ouest</option>
              <option>Est / Ouest</option>
              <option>Nord</option>
              <option>Je ne sais pas</option>
            </select>
          </div>
          <label style="display:flex;gap:10px;align-items:center;margin:8px 0">
            <input id="int60" type="checkbox" name="interesse_60" />
            Je suis intéressé par une réduction énergétique <b>jusqu’à 60%</b>
          </label>
          <button type="submit">Recevoir mon étude</button>
          <p class="ok" id="ok">✅ Merci ! Nous vous rappelons très vite.</p>
        </form>

        <!-- EXPLICATIONS -->
        <div class="card">
          <h3 style="margin-top:0">Comment ça marche ?</h3>
          <ol>
            <li>Vous complétez le formulaire.</li>
            <li>Un téléconseiller vérifie votre éligibilité.</li>
            <li>Étude technique à distance + devis.</li>
            <li>Signature électronique.</li>
            <li>Installation par un partenaire RGE.</li>
          </ol>
          <p style="margin-top:12px;font-size:14px;opacity:.8">C’est gratuit et sans engagement.</p>
        </div>
      </div>
    </section>

    <!-- BLOC DEBUG -->
    <section class="card">
      <h3 style="margin-top:0">Bloc Debug (lecture & écriture Supabase)</h3>
      <pre id="debug" class="debug">Debug prêt…</pre>
      <ul id="last5"></ul>
    </section>
  </main>

  <footer>© 2025 Freesolar — Tous droits réservés.</footer>

  <!-- SCRIPT SUPABASE -->
  <script>
    // ⚙️ Ton projet Supabase
    const SUPABASE_URL = "https://jwebaerikvvdaxyagkpx.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp3ZWJhZXJpa3Z2ZGF4eWFna3B4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUwMTEzNjMsImV4cCI6MjA3MDU4NzM2M30.mMC9F8sIovTE4r1HXKYXL8c9SexagzEqK6s_ErZ3fiI";

    const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    const debugEl = document.getElementById('debug');
    const listEl = document.getElementById('last5');

    function logDebug(obj) {
      debugEl.textContent = JSON.stringify({
        supabaseUrl_present: !!SUPABASE_URL,
        supabaseKey_present: !!SUPABASE_ANON_KEY,
        ...obj
      }, null, 2);
    }

    async function loadLeads() {
      const { data, error, status } = await sb
        .from('leads')
        .select('prenom,nom,email,created_at')
        .order('created_at', { ascending: false })
        .limit(5);

      logDebug({ get_status: status, get_error: error?.message || null, rows: data?.length || 0 });

      listEl.innerHTML = '';
      (data || []).forEach((l) => {
        const li = document.createElement('li');
        li.textContent = `${l.prenom || ''} ${l.nom || ''} — ${l.email || ''} (${new Date(l.created_at).toLocaleString()})`;
        listEl.appendChild(li);
      });
    }

    document.getElementById('lead').addEventListener('submit', async (e) => {
      e.preventDefault();
      const fd = new FormData(e.target);
      const payload = {
        prenom: String(fd.get('prenom') || ''),
        nom: String(fd.get('nom') || ''),
        telephone: String(fd.get('telephone') || ''),
        email: String(fd.get('email') || ''),
        proprietaire: String(fd.get('proprietaire') || ''),
        toiture: String(fd.get('toiture') || ''),
        interesse_60: !!fd.get('interesse_60'),
      };

      const { data, error, status } = await sb
        .from('leads')
        .insert([payload])
        .select();

      if (error) {
        alert("Erreur Supabase : " + error.message);
      }

      document.getElementById('ok').style.display = error ? 'none' : 'block';
      logDebug({ post_status: status, post_error: error?.message || null, inserted: data });
      if (!error) { e.target.reset(); await loadLeads(); }
    });

    // Chargement initial
    loadLeads();
  </script>
 <!-- ⚠️ BLOC DEBUG COLLER ICI -->
<div style="max-width:980px;margin:12px auto;padding:12px;background:#fff;border-radius:10px;box-shadow:0 8px 24px rgba(0,0,0,.06)">
  <h3 style="margin:0 0 8px">Debug Supabase</h3>
  <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px">
    <button id="testSelect">Tester SELECT</button>
    <button id="testInsert">Tester INSERT</button>
  </div>
  <pre id="dbg" style="background:#f3f4f6;padding:10px;border-radius:8px;font-size:12px;white-space:pre-wrap">Prêt…</pre>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  // ✅ Mets bien TES valeurs
  const SUPABASE_URL = "https://jwebaerikvvdaxyagkpx.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp3ZWJhZXJpa3Z2ZGF4eWFna3B4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUwMTEzNjMsImV4cCI6MjA3MDU4NzM2M30.mMC9F8sIovTE4r1HXKYXL8c9SexagzEqK6s_ErZ3fiI";

  const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  const dbg = document.getElementById('dbg');
  const log = (o) => dbg.textContent = JSON.stringify(o, null, 2);

  // SELECT explicite sur le schéma public
  async function testSelect() {
    const { data, error, status } = await sb
      .schema('public')
      .from('leads')
      .select('id, prenom, nom, created_at')
      .order('created_at', { ascending: false })
      .limit(5);

    log({ step: 'SELECT public.leads', status, error: error?.message || null, rows: data?.length || 0, data });
  }

  // INSERT minimal
  async function testInsert() {
    const { data, error, status } = await sb
      .schema('public')
      .from('leads')
      .insert([{ prenom: 'Test', nom: 'Debug', email: 'debug@example.com' }])
      .select();

    log({ step: 'INSERT public.leads', status, error: error?.message || null, data });
    if (!error) await testSelect();
  }

  document.getElementById('testSelect').onclick = testSelect;
  document.getElementById('testInsert').onclick = testInsert;

  // charge au démarrage
  testSelect();
</script>
<!-- /BLOC DEBUG --> 
</body>
</html>
